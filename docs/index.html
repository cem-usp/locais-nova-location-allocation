<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta charset="UTF-8">
<meta name="generator" content="quarto-1.8.24">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Daniel Vartanian, Letícia Gonçalves Silva, Camila N. Fernandes, &amp; Mariana A. Giannotti">
<meta name="dcterms.date" content="2025-11-21">
<title>A Reproducible Pipeline for Maximal Coverage Location-Allocation of Food Establishments in Brazil Using the Locais-Nova Scale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./images/favicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-51ed2b7efba85c808986edec323c5e71.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-6efe224236f7e5a1615e5d2b42852a6b.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-51ed2b7efba85c808986edec323c5e71.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-bb5183dd889ed94b30793f9b52eee8b6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d3ef5e81a44729a7b94f400bdb21a674.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-bb5183dd889ed94b30793f9b52eee8b6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta property="og:title" content="A Reproducible Pipeline for Maximal Coverage Location-Allocation of Food Establishments in Brazil Using the Locais-Nova Scale">
<meta property="og:description" content="">
<meta property="og:image" content="https://cem-usp.github.io/locais-nova-location-allocation/images/og-image.png">
<meta property="og:image:alt" content="Center for Metropolitan Studies">
<meta property="og:image:height" content="1600">
<meta property="og:image:width" content="2400">
<meta name="citation_title" content="A Reproducible Pipeline for Maximal Coverage Location-Allocation of Food Establishments in Brazil Using the Locais-Nova Scale
">
<meta name="citation_author" content="Daniel Vartanian, Letícia Gonçalves Silva, Camila N. Fernandes, &amp;amp; Mariana A. Giannotti">
<meta name="citation_publication_date" content="2025-11-21">
<meta name="citation_cover_date" content="2025-11-21">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-11-21">
<meta name="citation_fulltext_html_url" content="https://cem-usp.github.io/locais-nova-location-allocation/">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Quarto;,citation_abstract=Quarto is an open-source scientific and technical publishing system built on Pandoc.;,citation_author=J. J. Allaire;,citation_author=Charles Teague;,citation_author=Yihui Xie;,citation_author=Christophe Dervieux;,citation_fulltext_html_url=https://quarto.org;,citation_doi=10.5281/ZENODO.5960048;,citation_publisher=Zenodo;">
<meta name="citation_reference" content="citation_title=Banco de dados do Sistema Único de Saúde - DATASUS;,citation_author=Brasil;,citation_author=Ministério da Saúde;,citation_author=Departamento de Informática do SUS;,citation_fulltext_html_url=https://datasus.saude.gov.br/;,citation_language=pt-BR;">
<meta name="citation_reference" content="citation_title=Módulo gerador de relatórios públicos: estado nutricional dos indivíduos acompanhados por período, fase do ciclo da vida e índice;,citation_author=Brasil;,citation_author=Sistema de Vigilância Alimentar e Nutricional;,citation_fulltext_html_url=https://sisaps.saude.gov.br/sisvan/relatoriopublico;,citation_language=pt-BR;">
<meta name="citation_reference" content="citation_title=Friction surface: Global walking only friction surface;,citation_abstract=Global friction surface enumerating land-based travel walking-only speed without access to motorized transport This layer map provides estimates of time required to traverse each pixel within an approximately one-by one-kilometer gridded representation of the Earth’s surface. The speed units are expressed as minutes required to travel one metre. The movement rates encapsulated within the friction surfaces were based on landscape characteristics and transportation infrastructure, and no individual movement data was used to create them. The friction surfaces were made by combining geographic datasets that each characterize a layer-specific cost of moving through the landscape. These datasets consisted of roads, railways, navigable waterways, bodies of water, land cover types, topographic conditions (elevation and slope angle), and national borders. Descriptions of these datasets and their associated processing steps are provided in Weiss et al. (2018). Note, however, that we did not consider air travel in this analysis. In this walking-only friction surface, we assumed that all road travel was limited to a walking speed of five kilometers per hour and all water travel was reduced to the rate for traversing a wetland or swimming of 1.0 kilometer per hour. The walking-only friction provided an upper bound of movement rates for individuals who lack access to, or cannot use, motorized transport.;,citation_author=Malaria Atlas Project;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://data.malariaatlas.org/maps?layers=Accessibility:202001_Global_Walking_Only_Friction_Surface;,citation_language=en-US;">
<meta name="citation_reference" content="citation_title=OpenStreetMap;,citation_author=OpenStreetMap Contributors;,citation_fulltext_html_url=https://www.openstreetmap.org;,citation_publisher=OpenStreetMap Foundation;">
<meta name="citation_reference" content="citation_title=geocodebr: Geolocalização de endereços brasileiros;,citation_abstract=O {geocodebr} é um pacote computacional para geolicalização de endereços Brasileiros. O pacote oferece uma maneira simples e eficiente de geolocalizar dados sem limite de número de consultas. O pacote é baseado em conjuntos de dados espaciais abertos de endereços brasileiros, utilizando como fonte principal o Cadastro Nacional de Endereços para Fins Estatísticos (CNEFE). O CNEFE é publicado pelo Instituto Brasileiro de Geografia e Estatística (IBGE). Atualmente, o pacote está disponível apenas em R.;,citation_author=Rafael H. M. Pereira;,citation_author=Daniel Herszenhut;,citation_fulltext_html_url=https://ipeagit.github.io/geocodebr;,citation_doi=10.32614/CRAN.package.geocodebr;">
<meta name="citation_reference" content="citation_title=geobr: Download official spatial data sets of Brazil;,citation_abstract=geobr is a computational package to download official spatial data sets of Brazil. The package includes a wide range of geospatial data in geopackage format (like shapefiles but better), available at various geographic scales and for various years with harmonized attributes, projection and topology.;,citation_author=Rafael H. M. Pereira;,citation_author=Caio Nogueira Goncalves;,citation_fulltext_html_url=https://ipeagit.github.io/geobr;,citation_doi=10.32614/CRAN.package.geobr;">
<meta name="citation_reference" content="citation_title=R: A language and environment for statistical computing;,citation_author=R Core Team;,citation_fulltext_html_url=https://www.R-project.org;,citation_publisher=R Foundation for Statistical Computing;">
<meta name="citation_reference" content="citation_title=Sistema de classificação dos locais de aquisição de alimentos com base no &amp;amp;amp;lt;i&amp;gt;Guia Alimentar para a População Brasileira&amp;lt;/i&amp;gt;: Locais-Nova;,citation_abstract=Objetivo&nbsp; Propor um novo sistema de classificação de locais de aquisição de alimentos com base no Guia Alimentar para a População Brasileira, denominado Locais-Nova.Métodos&nbsp; Trata-se da utilização dos dados de aquisição domiciliar de alimentos da Pesquisa de Orçamentos Familiares 2017–2018. Os alimentos foram categorizados, segundo a classificação Nova, em alimentos in natura ou minimamente processados, ingredientes culinários, alimentos processados e alimentos ultraprocessados. Estimou-se a contribuição média de cada grupo da classificação Nova para o total de gramas adquiridas no Brasil. Comparou-se essa estimativa com a contribuição média de cada grupo da classificação Nova em cada um dos 16 locais de aquisição avaliados. Os locais foram classificados como “fontes de aquisição” para um grupo específico da classificação Nova sempre que a contribuição desse grupo em determinado local foi igual ou superior à média nacional.Resultados&nbsp; A Locais-Nova identificou três categorias de locais de aquisição: fontes de alimentos in natura ou minimamente processados e ingredientes culinários, fontes de alimentos processados e fontes de alimentos ultraprocessados. Hortifrutigranjeiros e açougues destacaram-se como principais fontes de alimentos in natura ou minimamente processados; minimercados e mercearias, como principais fontes de alimentos ultraprocessados; e padarias e confeitarias, como fontes de alimentos processados e ultraprocessados. Supermercados foram classificados como fontes de alimentos in natura ou minimamente processados e ultraprocessados.Conclusão&nbsp; Este estudo apresentou a classificação inovadora dos locais de aquisição de alimentos. Isso refletiu as recomendações do Guia Alimentar para a População Brasileira e possibilitou entender os padrões de aquisição alimentar nos diferentes tipos de locais.Palavras-chaveGuias Alimentares; Atenção Primária; Locais de Aquisição; Classificação Nova; Aquisição de Alimentos;,citation_author=Marcos Anderson Lucas Silva;,citation_author=Larissa Loures Mendes;,citation_author=Maria Alvim Leite;,citation_author=Luana Lara Rocha;,citation_author=Camila Aparecida Borges;,citation_author=Renata Bertazzi Levy;,citation_author=Maria Laura da Costa Louzada;,citation_publication_date=2025;,citation_cover_date=2025;,citation_year=2025;,citation_fulltext_html_url=https://www.scielo.br/j/ress/a/JnTLxYNL8Shg9KCWz4bcJfG/?lang=pt;,citation_doi=10.1590/S2237-96222025v34.20240361.pt;,citation_issn=1679-4974, 2237-9622;,citation_volume=34;,citation_language=pt-PT;,citation_journal_title=Epidemiologia e Serviços de Saúde;,citation_journal_abbrev=Epidemiol. Serv. Saúde;,citation_publisher=Secretaria de Vigilância em Saúde e Ambiente - Ministério da Saúde do Brasil;">
<meta name="citation_reference" content="citation_title=renv: Project environments;,citation_abstract=A dependency management toolkit for R. Using ’renv’, you can create and manage project-local R libraries, save the state of these libraries to a ’lockfile’, and later restore your library as required. Together, these tools can help make your projects more isolated, portable, and reproducible.;,citation_author=Kevin Ushey;,citation_author=Hadley Wickham;,citation_fulltext_html_url=https://doi.org/10.32614/CRAN.package.renv;">
<meta name="citation_reference" content="citation_title=A reproducible pipeline for processing, geocoding, and classifying CNPJs from the Brazilian Federal Revenue Service (RFB) using the Locais-Nova scale;,citation_abstract=A reproducible pipeline for processing, geocoding, and classifying CNPJs from the Brazilian Federal Revenue Service (RFB) using the Locais-Nova scale.;,citation_author=Daniel Vartanian;,citation_author=Clara de Lima e Silva Penz;,citation_author=Gabriel Caldeira;,citation_author=Camila Nastari Fernandes;,citation_author=Mariana Abrantes Giannotti;,citation_publication_date=2025;,citation_cover_date=2025;,citation_year=2025;,citation_fulltext_html_url=https://cem-usp.github.io/locais-nova-rfb-geocoding;,citation_publisher=Center for Metropolitan Studies of the University of São Paulo;">
<meta name="citation_reference" content="citation_title=The tidy tools manifesto;,citation_abstract=tidyverse;,citation_author=Hadley Wickham;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://tidyverse.tidyverse.org/articles/manifesto.html;,citation_language=en-US;,citation_publisher=Tidyverse;">
<meta name="citation_reference" content="citation_title=R for data science: Import, tidy, transform, visualize, and model data;,citation_abstract=Use R to turn data into insight, knowledge, and understanding. With this practical book, aspiring data scientists will learn how to do data science with R and RStudio, along with the tidyverseâ??a collection of R packages designed to work together to make data science fast, fluent, and fun. Even if you have no programming experience, this updated edition will have you doing data science quickly. You’ll learn how to import, transform, and visualize your data and communicate the results. And you’ll get a complete, big-picture understanding of the data science cycle and the basic tools you need to manage the details. Updated for the latest tidyverse features and best practices, new chapters show you how to get data from spreadsheets, databases, and websites. Exercises help you practice what you’ve learned along the way.;,citation_author=Hadley Wickham;,citation_author=Mine Çetinkaya-Rundel;,citation_author=Garrett Grolemund;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://r4ds.hadley.nz;,citation_isbn=978-1-4920-9740-2;,citation_language=en-US;">
<meta name="citation_reference" content="citation_title=The tidyverse style guide;,citation_author=Hadley Wickham;,citation_fulltext_html_url=https://style.tidyverse.org;,citation_language=en-US;">
<meta name="citation_reference" content="citation_title=Tidy design principles;,citation_author=Hadley Wickham;,citation_fulltext_html_url=https://design.tidyverse.org;,citation_language=en-US;">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cem-usp/locais-nova-location-allocation/"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem">Problem</a></li>
  <li><a href="#data-availability" id="toc-data-availability" class="nav-link" data-scroll-target="#data-availability">Data Availability</a></li>
  <li>
<a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul>
<li><a href="#source-of-data" id="toc-source-of-data" class="nav-link" data-scroll-target="#source-of-data">Source of Data</a></li>
  <li><a href="#data-munging" id="toc-data-munging" class="nav-link" data-scroll-target="#data-munging">Data Munging</a></li>
  <li><a href="#code-style" id="toc-code-style" class="nav-link" data-scroll-target="#code-style">Code Style</a></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility">Reproducibility</a></li>
  </ul>
</li>
  <li>
<a href="#set-the-environment" id="toc-set-the-environment" class="nav-link" data-scroll-target="#set-the-environment">Set the Environment</a>
  <ul>
<li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load Packages</a></li>
  <li><a href="#set-keys" id="toc-set-keys" class="nav-link" data-scroll-target="#set-keys">Set Keys</a></li>
  <li><a href="#set-data-directory" id="toc-set-data-directory" class="nav-link" data-scroll-target="#set-data-directory">Set Data Directory</a></li>
  <li><a href="#set-initial-variables" id="toc-set-initial-variables" class="nav-link" data-scroll-target="#set-initial-variables">Set Initial Variables</a></li>
  </ul>
</li>
  <li>
<a href="#download-rfb-data" id="toc-download-rfb-data" class="nav-link" data-scroll-target="#download-rfb-data">Download RFB Data</a>
  <ul>
<li><a href="#download-file" id="toc-download-file" class="nav-link" data-scroll-target="#download-file">Download File</a></li>
  <li><a href="#unlock-file" id="toc-unlock-file" class="nav-link" data-scroll-target="#unlock-file">Unlock File</a></li>
  </ul>
</li>
  <li><a href="#download-and-import-municipality-shape" id="toc-download-and-import-municipality-shape" class="nav-link" data-scroll-target="#download-and-import-municipality-shape">Download and Import Municipality Shape</a></li>
  <li><a href="#download-and-import-census-tract-population-data" id="toc-download-and-import-census-tract-population-data" class="nav-link" data-scroll-target="#download-and-import-census-tract-population-data">Download and Import Census Tract Population Data</a></li>
  <li><a href="#download-and-import-census-tract-shape-data" id="toc-download-and-import-census-tract-shape-data" class="nav-link" data-scroll-target="#download-and-import-census-tract-shape-data">Download and Import Census Tract Shape Data</a></li>
  <li><a href="#filter-and-join-census-data" id="toc-filter-and-join-census-data" class="nav-link" data-scroll-target="#filter-and-join-census-data">Filter and Join Census Data</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import Data</a></li>
  <li><a href="#filter-data" id="toc-filter-data" class="nav-link" data-scroll-target="#filter-data">Filter Data</a></li>
  <li><a href="#transform-data" id="toc-transform-data" class="nav-link" data-scroll-target="#transform-data">Transform Data</a></li>
  <li>
<a href="#exploratory-analysis" id="toc-exploratory-analysis" class="nav-link" data-scroll-target="#exploratory-analysis">Exploratory Analysis</a>
  <ul>
<li><a href="#glimpse-data" id="toc-glimpse-data" class="nav-link" data-scroll-target="#glimpse-data">Glimpse Data</a></li>
  <li><a href="#plot-establishments" id="toc-plot-establishments" class="nav-link" data-scroll-target="#plot-establishments">Plot Establishments</a></li>
  <li><a href="#plot-tract-population" id="toc-plot-tract-population" class="nav-link" data-scroll-target="#plot-tract-population">Plot Tract Population</a></li>
  </ul>
</li>
  <li>
<a href="#compute-maximal-coverage-location-allocation" id="toc-compute-maximal-coverage-location-allocation" class="nav-link" data-scroll-target="#compute-maximal-coverage-location-allocation">Compute Maximal Coverage Location-Allocation</a>
  <ul>
<li><a href="#filter-locais-nova-group" id="toc-filter-locais-nova-group" class="nav-link" data-scroll-target="#filter-locais-nova-group">Filter Locais-Nova Group</a></li>
  <li><a href="#normalize-municipality-shape-crs" id="toc-normalize-municipality-shape-crs" class="nav-link" data-scroll-target="#normalize-municipality-shape-crs">Normalize Municipality Shape CRS</a></li>
  <li><a href="#plot-food-establishments" id="toc-plot-food-establishments" class="nav-link" data-scroll-target="#plot-food-establishments">Plot Food Establishments</a></li>
  <li><a href="#compute-travel-time" id="toc-compute-travel-time" class="nav-link" data-scroll-target="#compute-travel-time">Compute Travel Time</a></li>
  <li><a href="#plot-travel-time" id="toc-plot-travel-time" class="nav-link" data-scroll-target="#plot-travel-time">Plot Travel Time</a></li>
  <li><a href="#rasterize-population-data" id="toc-rasterize-population-data" class="nav-link" data-scroll-target="#rasterize-population-data">Rasterize Population Data</a></li>
  <li><a href="#compute-travel-time-stats" id="toc-compute-travel-time-stats" class="nav-link" data-scroll-target="#compute-travel-time-stats">Compute Travel Time Stats</a></li>
  <li><a href="#compute-location-allocation-continuous-approach" id="toc-compute-location-allocation-continuous-approach" class="nav-link" data-scroll-target="#compute-location-allocation-continuous-approach">Compute Location-Allocation (Continuous Approach)</a></li>
  <li><a href="#plot-location-allocation-continuous-approach" id="toc-plot-location-allocation-continuous-approach" class="nav-link" data-scroll-target="#plot-location-allocation-continuous-approach">Plot Location-Allocation (Continuous Approach)</a></li>
  <li><a href="#compute-location-allocation-discrete-approach" id="toc-compute-location-allocation-discrete-approach" class="nav-link" data-scroll-target="#compute-location-allocation-discrete-approach">Compute Location-Allocation (Discrete Approach)</a></li>
  <li><a href="#plot-location-allocation-discrete-approach" id="toc-plot-location-allocation-discrete-approach" class="nav-link" data-scroll-target="#plot-location-allocation-discrete-approach">Plot Location-Allocation (Discrete Approach)</a></li>
  </ul>
</li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  <li><a href="#license" id="toc-license" class="nav-link" data-scroll-target="#license">License</a></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link" data-scroll-target="#acknowledgments">Acknowledgments</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/edit/main/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/blob/main/index.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/issues/" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://centrodametropole.fflch.usp.br"><i class="bi bi-link-45deg"></i>Center for Metropolitan Studies</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"></h1>
<p>A Reproducible Pipeline for Maximal Coverage Location-Allocation of Food Establishments in Brazil Using the Locais-Nova Scale</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Vartanian, Letícia Gonçalves Silva, Camila N. Fernandes, &amp; Mariana A. Giannotti </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><!-- badges: start --><p><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" class="img-fluid" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a> <a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/license-GPLv3-bd0000.svg" class="img-fluid" alt="License: GPLv3"></a> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/license-CC_BY--NC--SA_4.0-lightgrey.svg" class="img-fluid" alt="License: CC BY-NC-SA 4.0"></a> <!-- badges: end --></p>
<section id="overview" class="level2"><h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This report provides a reproducible pipeline for calculating the Maximal Coverage <a href="https://en.wikipedia.org/wiki/Location-allocation">Location-Allocation</a> to identify optimal locations for one or more facilities, specifically targeting food establishments, to maximize accessibility and coverage within the defined area.</p>
<p>For instructions on how to run the pipeline, see the repository <a href="https://github.com/cem-usp/locais-nova-location-allocation/blob/main/README.md">README</a>.</p>
</section><section id="problem" class="level2"><h2 class="anchored" data-anchor-id="problem">Problem</h2>
<!-- Add a brief description of the problem being addressed. -->
</section><section id="data-availability" class="level2"><h2 class="anchored" data-anchor-id="data-availability">Data Availability</h2>
<!-- Add OSF badge. -->
<p>The processed data are available in <a href="https://en.wikipedia.org/wiki/Comma-separated_values"><code>csv</code></a>, <a href="https://rdrr.io/r/base/readRDS.html"><code>rds</code></a> and <a href="https://en.wikipedia.org/wiki/Apache_Parquet"><code>parquet</code></a> formats through dedicated repositories on the Open Science Framework (<a href="https://osf.io/">OSF</a>). A metadata file is included alongside the validated datasets.</p>
<p>Only authorized personnel can access the processed files. They are protected with <a href="https://en.wikipedia.org/wiki/RSA_cryptosystem">RSA</a> 4096-bit encryption (<a href="https://www.openssl.org/">OpenSSL</a>) and a 32-byte password to ensure data security.</p>
</section><section id="methods" class="level2"><h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="source-of-data" class="level3"><h3 class="anchored" data-anchor-id="source-of-data">Source of Data</h3>
<p>The data used in this report come from the following sources:</p>
<ul>
<li>Brazilian Federal Revenue Service (<a href="https://www.gov.br/receitafederal/">RFB</a>)
<ul>
<li>Data on legal entities from the National Register of Legal Entities (<a href="https://en.wikipedia.org/wiki/CNPJ">CNPJ</a>) <a href="https://dados.gov.br/dados/conjuntos-dados/cadastro-nacional-da-pessoa-juridica---cnpj">database</a>, used for company identification <span class="citation" data-cites="brasil">(<a href="#ref-brasil" role="doc-biblioref">Brasil et al., n.d.</a>)</span>.</li>
<li>Data on <a href="https://dados.gov.br/dados/conjuntos-dados/tabela-de-rgos-e-municpios">Brazilian agencies and municipalities</a> (<em>Tabela de Órgãos e Municípios</em>, TOM) <span class="citation" data-cites="brasila">(<a href="#ref-brasila" role="doc-biblioref">Brasil &amp; Sistema de Vigilância Alimentar e Nutricional, n.d.</a>)</span>.</li>
</ul>
</li>
<li>Brazilian Institute of Geography and Statistics (<a href="https://www.ibge.gov.br/">IBGE</a>)
<ul>
<li>Municipality data via the <a href="https://ipeagit.github.io/geobr/"><code>geobr</code></a> R package <span class="citation" data-cites="pereirab">(<a href="#ref-pereirab" role="doc-biblioref">Pereira &amp; Goncalves, n.d.</a>)</span>.</li>
<li>Municipality and census tract shapes via the <a href="https://ipeagit.github.io/geobr/"><code>geobr</code></a> R package <span class="citation" data-cites="pereirab">(<a href="#ref-pereirab" role="doc-biblioref">Pereira &amp; Goncalves, n.d.</a>)</span>.</li>
<li>Census tract population data via the <a href="https://ipeagit.github.io/censobr/"><code>censobr</code></a> R package <span class="citation" data-cites="pereirab">(<a href="#ref-pereirab" role="doc-biblioref">Pereira &amp; Goncalves, n.d.</a>)</span>.</li>
<li>Open spatial datasets of Brazilian addresses from the National Address Register for Statistical Purposes (<a href="https://www.ibge.gov.br/estatisticas/sociais/populacao/38734-cadastro-nacional-de-enderecos-para-fins-estatisticos.html">CNEFE</a>), used for geocoding via the <a href="https://ipeagit.github.io/geocodebr/"><code>geocodebr</code></a> R package <span class="citation" data-cites="pereiraa">(<a href="#ref-pereiraa" role="doc-biblioref">Pereira &amp; Herszenhut, n.d.</a>)</span>.</li>
</ul>
</li>
<li>Center for Metropolitan Studies (<a href="https://centrodametropole.fflch.usp.br/">CEM</a>)
<ul>
<li>Lookup table providing the classification linking the establishments <a href="https://www.gov.br/receitafederal/pt-br/assuntos/orientacao-tributaria/cadastros/cnpj/classificacao-nacional-de-atividades-economicas-2013-cnae">CNAEs</a> (National Classification of Economic Activities) codes to the <a href="https://doi.org/10.1590/S2237-96222025v34.20240361.en">Locais-Nova</a> groups (Fernandes &amp; Giannotti, 2025). This data will remain private until further notice.</li>
</ul>
</li>
<li>Malaria Atlas Project (<a href="https://malariaatlas.org/">MAP</a>)
<ul>
<li>Data on <a href="https://en.wikipedia.org/wiki/Friction_of_distance">spatial friction</a> based on the <em>Global Walking Only Friction Surface</em> dataset <span class="citation" data-cites="map2019a">(<a href="#ref-map2019a" role="doc-biblioref">Malaria Atlas Project, 2019</a>)</span>, used to calculate travel times.</li>
</ul>
</li>
<li>OpenStreetMap (<a href="https://www.openstreetmap.org/">OSM</a>)
<ul>
<li>Data on <a href="https://wiki.openstreetmap.org/wiki/Map_features#Highway">road and footpaths</a> <span class="citation" data-cites="openstreetmap">(<a href="#ref-openstreetmap" role="doc-biblioref">OpenStreetMap Contributors, n.d.</a>)</span>, used to calculate travel times.</li>
</ul>
</li>
</ul>
<p>The dataset related to the Brazilian Federal Revenue Service (<a href="https://www.gov.br/receitafederal/">RFB</a>) used in this report was processed by Vartanian et al.&nbsp;(<span class="citation" data-cites="vartanian2025z">(<a href="#ref-vartanian2025z" role="doc-biblioref">2025</a>)</span>) and has its own dedicated pipeline, which can be accessed at: <a href="https://cem-usp.github.io/locais-nova-rfb-geocoding/" class="uri">https://cem-usp.github.io/locais-nova-rfb-geocoding/</a>.</p>
</section><section id="data-munging" class="level3"><h3 class="anchored" data-anchor-id="data-munging">Data Munging</h3>
<p>The data munging follow the data science workflow outlined by <span class="citation" data-cites="wickham2023e">Wickham et al. (<a href="#ref-wickham2023e" role="doc-biblioref">2023</a>)</span>, as illustrated in <a href="#fig-wickham-at-al-2023-figure-1" class="quarto-xref">Figure&nbsp;1</a>. All processes were made using the <a href="https://quarto.org/">Quarto</a> publishing system <span class="citation" data-cites="allaire">(<a href="#ref-allaire" role="doc-biblioref">Allaire et al., n.d.</a>)</span>, the <a href="https://www.r-project.org/">R</a> programming language <span class="citation" data-cites="rcoreteama">(<a href="#ref-rcoreteama" role="doc-biblioref">R Core Team, n.d.</a>)</span> and several R packages.</p>
<p>For data manipulation and workflow, priority was given to packages from the <a href="https://www.tidyverse.org/">tidyverse</a>, <a href="https://ropensci.org/">rOpenSci</a> and <a href="https://r-spatial.org/">r-spatial</a> ecosystems, as well as other packages adhering to the tidy tools manifesto <span class="citation" data-cites="wickham2023c">(<a href="#ref-wickham2023c" role="doc-biblioref">Wickham, 2023</a>)</span>.</p>
<div id="fig-wickham-at-al-2023-figure-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-wickham-at-al-2023-figure-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Data science workflow created by Wickham, Çetinkaya-Runde, and Grolemund.
</figcaption><div aria-describedby="fig-wickham-at-al-2023-figure-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p><a href="images/wickham-at-al-2023-figure-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Data science workflow created by Wickham, Çetinkaya-Runde, and Grolemund."><img src="images/wickham-at-al-2023-figure-1.png" class="img-fluid figure-img" style="width:75.0%"></a></p>
<p><span class="legend">Source: Reproduced from <span class="citation" data-cites="wickham2023e">Wickham et al. (<a href="#ref-wickham2023e" role="doc-biblioref">2023</a>)</span>.</span></p>
</div>
</figure>
</div>
</section><section id="code-style" class="level3"><h3 class="anchored" data-anchor-id="code-style">Code Style</h3>
<p>The Tidyverse <a href="https://style.tidyverse.org/">code style guide</a> <span class="citation" data-cites="wickhamb">(<a href="#ref-wickhamb" role="doc-biblioref">Wickham, n.d.-a</a>)</span> and <a href="https://design.tidyverse.org/">design principles</a> <span class="citation" data-cites="wickhamc">(<a href="#ref-wickhamc" role="doc-biblioref">Wickham, n.d.-b</a>)</span> were followed to ensure consistency and enhance readability.</p>
</section><section id="reproducibility" class="level3"><h3 class="anchored" data-anchor-id="reproducibility">Reproducibility</h3>
<p>The pipeline is fully reproducible and can be run again at any time. To ensure consistent results, the <a href="https://rstudio.github.io/renv/"><code>renv</code></a> package <span class="citation" data-cites="usheya">(<a href="#ref-usheya" role="doc-biblioref">Ushey &amp; Wickham, n.d.</a>)</span> is used to manage and restore the R environment. See the <a href="https://github.com/cem-usp/locais-nova-location-allocation/blob/main/README.md">README</a> file in the code repository to learn how to run it.</p>
</section></section><section id="set-the-environment" class="level2"><h2 class="anchored" data-anchor-id="set-the-environment">Set the Environment</h2>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This section sets up the R environment needed for the workflow.</p>
</div>
</div>
</div>
<section id="load-packages" class="level3"><h3 class="anchored" data-anchor-id="load-packages">Load Packages</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-lib.r-universe.dev/askpass">askpass</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://danielvartan.github.io/brandr/">brandr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rasmusab/beepr">beepr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/censobr">censobr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org">fs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/geobr/">geobr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="co"># remotes::install_github("danielvartan/locationallocation")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://giacfalk.github.io/locationallocation">locationallocation</a></span><span class="op">)</span></span>
<span><span class="co"># remotes::install_github("danielvartan/lockr")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://danielvartan.github.io/lockr/">lockr</a></span><span class="op">)</span> <span class="co"># github.com/danielvartan/lockr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="co"># remotes::install_github("danielvartan/orbis")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://danielvartan.github.io/orbis/">orbis</a></span><span class="op">)</span> <span class="co"># github.com/danielvartan/orbis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osfr/">osfr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="set-keys" class="level3"><h3 class="anchored" data-anchor-id="set-keys">Set Keys</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>See the <a href="#data-availability">Data Availability</a> section for more information.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/osfr/reference/osf_auth.html">osf_auth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"OSF_PAT"</span><span class="op">)</span><span class="op">)</span> <span class="co"># askpass())</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">public_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"_ssh"</span>, <span class="st">"id_rsa.pub"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">private_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"_ssh"</span>, <span class="st">"id_rsa"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">password</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"ACESSOSAN_PASSWORD"</span><span class="op">)</span> <span class="co"># askpass()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="set-data-directory" class="level3"><h3 class="anchored" data-anchor-id="set-data-directory">Set Data Directory</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html">dir_exists</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="va">data_dir</span>, recurse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="set-initial-variables" class="level3"><h3 class="anchored" data-anchor-id="set-initial-variables">Set Initial Variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>year</code> variable is related to the year of the <a href="https://www.gov.br/receitafederal/">RFB</a> dataset.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">2025</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This pipeline utilizes the Locais-Nova scale groups <span class="citation" data-cites="silva2025">(<a href="#ref-silva2025" role="doc-biblioref">Silva et al., 2025</a>)</span> to classify food establishments. The <code>G0</code> group is a distinct subset comprising establishments from the <code>G1-G2</code> group that are not simultaneously classified under <code>G3</code> or <code>G4</code>.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">locais_nova_group</span> <span class="op">&lt;-</span> <span class="st">"G0"</span> <span class="co"># G1-G2, G3, G4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>objective_minutes</code> variable defines the maximum travel time (in minutes) for coverage analysis.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">objective_minutes</span> <span class="op">&lt;-</span> <span class="fl">15</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Select only <strong>one</strong> municipality at a time by uncommenting the corresponding IBGE code.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">municipality</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="co"># IBGE Codes</span></span>
<span>  <span class="co"># 1721000 # Palmas (2.227,329 km²)</span></span>
<span>  <span class="fl">2507507</span> <span class="co"># João Pessoa (210,044 km²)</span></span>
<span>  <span class="co"># 3106200 # Belo Horizonte (331,354 km²)</span></span>
<span>  <span class="co"># 3550308 # São Paulo (1.521,202 km²)</span></span>
<span>  <span class="co"># 4314902 # Porto Alegre (495,977 km²)</span></span>
<span>  <span class="co"># 5208707 # Goiânia (729,296 km²)</span></span>
<span>  <span class="co"># 5300108 # Brasília (5.760,783 km²)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="download-rfb-data" class="level2"><h2 class="anchored" data-anchor-id="download-rfb-data">Download RFB Data</h2>
<section id="download-file" class="level3"><h3 class="anchored" data-anchor-id="download-file">Download File</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">osf_raw_data_id</span> <span class="op">&lt;-</span> <span class="st">"2x6jb"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">osf_raw_data_files</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">osf_raw_data_id</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osfr/reference/osf_retrieve.html">osf_retrieve_node</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osfr/reference/osf_ls_files.html">osf_ls_files</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    pattern <span class="op">=</span> <span class="st">"2025-01.rds.lockr"</span>,</span>
<span>    n_max <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">osf_raw_data_files</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["meta"],"name":[3],"type":["list"],"align":["right"]}],"data":[{"1":"2025-01.rds.lockr","2":"690841d0c22b600df396c1ef","3":"<named list [3]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rfb_file</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">osf_raw_data_files</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osfr/reference/osf_download.html">osf_download</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">data_dir</span>, conflicts <span class="op">=</span> <span class="st">"overwrite"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">extract2</a></span><span class="op">(</span><span class="st">"local_path"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="unlock-file" class="level3"><h3 class="anchored" data-anchor-id="unlock-file">Unlock File</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rfb_file</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://danielvartan.github.io/lockr/reference/lock_file.html">unlock_file</a></span><span class="op">(</span></span>
<span>    private_key <span class="op">=</span> <span class="va">private_key</span>,</span>
<span>    suffix <span class="op">=</span> <span class="st">".lockr"</span>,</span>
<span>    remove_file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    password <span class="op">=</span> <span class="va">password</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="download-and-import-municipality-shape" class="level2"><h2 class="anchored" data-anchor-id="download-and-import-municipality-shape">Download and Import Municipality Shape</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">shape</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">municipality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ipeagit.github.io/geobr/reference/read_municipality.html">read_municipality</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://danielvartan.github.io/orbis/reference/closest_geobr_year.html">closest_geobr_year</a></span><span class="op">(</span><span class="va">year</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    showProgress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">code_muni</span>, <span class="va">geom</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>municipality_code <span class="op">=</span> <span class="va">code_muni</span>, geometry <span class="op">=</span> <span class="va">geom</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">shape</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["municipality_code"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["geometry"],"name":[2],"type":["s_MULTIP"],"align":["right"]}],"data":[{"1":"2507507","2":"<s_MULTIP>","_rn_":"96"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="download-and-import-census-tract-population-data" class="level2"><h2 class="anchored" data-anchor-id="download-and-import-census-tract-population-data">Download and Import Census Tract Population Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_population_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ipeagit.github.io/censobr/reference/read_tracts.html">read_tracts</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fl">2022</span>, <span class="co"># Last available year</span></span>
<span>    dataset <span class="op">=</span> <span class="st">"Basico"</span>,</span>
<span>    as_data_frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    showProgress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Reading data cached locally.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_population_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; FileSystemDataset with 1 Parquet file</span></span>
<span><span class="co">#&gt; 468,099 rows x 36 columns</span></span>
<span><span class="co">#&gt; $ code_tract               &lt;string&gt; "110001505000002", "110001505000003", "11…</span></span>
<span><span class="co">#&gt; $ situacao                 &lt;string&gt; "Urbana", "Urbana", "Urbana", "Urbana", "…</span></span>
<span><span class="co">#&gt; $ code_situacao            &lt;double&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 8, 8,…</span></span>
<span><span class="co">#&gt; $ code_type                &lt;double&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">#&gt; $ area_km2                 &lt;double&gt; 0.5393102, 0.2362175, 0.2118666, 0.505447…</span></span>
<span><span class="co">#&gt; $ code_region              &lt;double&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">#&gt; $ name_region              &lt;string&gt; "Norte", "Norte", "Norte", "Norte", "Nort…</span></span>
<span><span class="co">#&gt; $ code_state               &lt;double&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…</span></span>
<span><span class="co">#&gt; $ name_state               &lt;string&gt; "Rondônia", "Rondônia", "Rondônia", "Rond…</span></span>
<span><span class="co">#&gt; $ code_muni                &lt;double&gt; 1100015, 1100015, 1100015, 1100015, 11000…</span></span>
<span><span class="co">#&gt; $ name_muni                &lt;string&gt; "Alta Floresta D'Oeste", "Alta Floresta D…</span></span>
<span><span class="co">#&gt; $ code_district            &lt;double&gt; 110001505, 110001505, 110001505, 11000150…</span></span>
<span><span class="co">#&gt; $ name_district            &lt;string&gt; "Alta Floresta D'Oeste", "Alta Floresta D…</span></span>
<span><span class="co">#&gt; $ code_subdistrict         &lt;double&gt; 11000150500, 11000150500, 11000150500, 11…</span></span>
<span><span class="co">#&gt; $ name_subdistrict         &lt;string&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ code_neighborhood        &lt;double&gt; 1100015006, 1100015006, 1100015005, 11000…</span></span>
<span><span class="co">#&gt; $ name_neighborhood        &lt;string&gt; "Redondo", "Redondo", "Princesa Isabel", …</span></span>
<span><span class="co">#&gt; $ code_nucleo_urbano       &lt;double&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ name_nucleo_urbano       &lt;string&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ code_favela              &lt;double&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ name_favela              &lt;string&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ code_aglomerado          &lt;double&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ name_aglomerado          &lt;string&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ code_intermediate        &lt;double&gt; 1102, 1102, 1102, 1102, 1102, 1102, 1102,…</span></span>
<span><span class="co">#&gt; $ name_intermediate        &lt;string&gt; "Ji-Paraná", "Ji-Paraná", "Ji-Paraná", "J…</span></span>
<span><span class="co">#&gt; $ code_immediate           &lt;double&gt; 110005, 110005, 110005, 110005, 110005, 1…</span></span>
<span><span class="co">#&gt; $ name_immediate           &lt;string&gt; "Cacoal", "Cacoal", "Cacoal", "Cacoal", "…</span></span>
<span><span class="co">#&gt; $ code_urban_concentration &lt;double&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ name_urban_concentration &lt;string&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ V0001                    &lt;double&gt; 928, 556, 222, 785, 748, 631, 884, 762, 2…</span></span>
<span><span class="co">#&gt; $ V0002                    &lt;double&gt; 376, 243, 102, 318, 334, 298, 386, 357, 1…</span></span>
<span><span class="co">#&gt; $ V0003                    &lt;double&gt; 376, 243, 102, 318, 334, 298, 386, 357, 1…</span></span>
<span><span class="co">#&gt; $ V0004                    &lt;double&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0,…</span></span>
<span><span class="co">#&gt; $ V0005                    &lt;double&gt; 2.8, 2.7, 2.6, 2.8, 2.6, 2.7, 2.7, 2.6, 2…</span></span>
<span><span class="co">#&gt; $ V0006                    &lt;double&gt; 0.0923, 0.0048, 0.0000, 0.0000, 0.0447, 0…</span></span>
<span><span class="co">#&gt; $ V0007                    &lt;double&gt; 336, 208, 85, 282, 291, 234, 329, 291, 10…</span></span>
<span><span class="co">#&gt; Call `print()` for full schema details</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="download-and-import-census-tract-shape-data" class="level2"><h2 class="anchored" data-anchor-id="download-and-import-census-tract-shape-data">Download and Import Census Tract Shape Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_tract_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ipeagit.github.io/geobr/reference/read_census_tract.html">read_census_tract</a></span><span class="op">(</span></span>
<span>    code_tract <span class="op">=</span> <span class="va">municipality</span>,</span>
<span>    year <span class="op">=</span> <span class="fl">2022</span>, <span class="co"># Last available year</span></span>
<span>    simplified <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    showProgress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    cache <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Using year/date 2022</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_tract_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1,778</span></span>
<span><span class="co">#&gt; Columns: 24</span></span>
<span><span class="co">#&gt; $ code_tract               &lt;dbl&gt; 250750705000001, 250750705000002, 25075070…</span></span>
<span><span class="co">#&gt; $ code_muni                &lt;dbl&gt; 2507507, 2507507, 2507507, 2507507, 250750…</span></span>
<span><span class="co">#&gt; $ name_muni                &lt;chr&gt; "João Pessoa", "João Pessoa", "João Pessoa…</span></span>
<span><span class="co">#&gt; $ name_neighborhood        &lt;chr&gt; "Varjão", "Varjão", "Varjão", "Varjão", "V…</span></span>
<span><span class="co">#&gt; $ code_neighborhood        &lt;dbl&gt; 2507507057, 2507507057, 2507507057, 250750…</span></span>
<span><span class="co">#&gt; $ code_subdistrict         &lt;dbl&gt; 25075070500, 25075070500, 25075070500, 250…</span></span>
<span><span class="co">#&gt; $ name_subdistrict         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ code_district            &lt;dbl&gt; 250750705, 250750705, 250750705, 250750705…</span></span>
<span><span class="co">#&gt; $ name_district            &lt;chr&gt; "João Pessoa", "João Pessoa", "João Pessoa…</span></span>
<span><span class="co">#&gt; $ code_urban_concentration &lt;dbl&gt; 2507507, 2507507, 2507507, 2507507, 250750…</span></span>
<span><span class="co">#&gt; $ name_urban_concentration &lt;chr&gt; "João Pessoa/PB", "João Pessoa/PB", "João …</span></span>
<span><span class="co">#&gt; $ code_state               &lt;dbl&gt; 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25…</span></span>
<span><span class="co">#&gt; $ name_state               &lt;chr&gt; "Paraíba", "Paraíba", "Paraíba", "Paraíba"…</span></span>
<span><span class="co">#&gt; $ code_immediate           &lt;dbl&gt; 250001, 250001, 250001, 250001, 250001, 25…</span></span>
<span><span class="co">#&gt; $ name_immediate           &lt;chr&gt; "João Pessoa", "João Pessoa", "João Pessoa…</span></span>
<span><span class="co">#&gt; $ code_intermediate        &lt;dbl&gt; 2501, 2501, 2501, 2501, 2501, 2501, 2501, …</span></span>
<span><span class="co">#&gt; $ name_intermediate        &lt;chr&gt; "João Pessoa", "João Pessoa", "João Pessoa…</span></span>
<span><span class="co">#&gt; $ code_region              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …</span></span>
<span><span class="co">#&gt; $ name_region              &lt;chr&gt; "Nordeste", "Nordeste", "Nordeste", "Norde…</span></span>
<span><span class="co">#&gt; $ situacao                 &lt;chr&gt; "Urbana", "Urbana", "Urbana", "Urbana", "U…</span></span>
<span><span class="co">#&gt; $ code_situacao            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span></span>
<span><span class="co">#&gt; $ code_type                &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, …</span></span>
<span><span class="co">#&gt; $ area_km2                 &lt;dbl&gt; 0.04631267269, 0.06271278332, 0.0554140691…</span></span>
<span><span class="co">#&gt; $ geom                     &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-34.8739674..…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="filter-and-join-census-data" class="level2"><h2 class="anchored" data-anchor-id="filter-and-join-census-data">Filter and Join Census Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">census_population_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">code_muni</span> <span class="op">==</span> <span class="va">.env</span><span class="op">$</span><span class="va">municipality</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">code_tract</span>, <span class="va">V0001</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>population <span class="op">=</span> <span class="va">V0001</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code_tract <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">code_tract</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">census_tract_data</span>, by <span class="op">=</span> <span class="st">"code_tract"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>tract_code <span class="op">=</span> <span class="va">code_tract</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tract_code</span>, <span class="va">population</span>, <span class="va">geom</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1,778</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ tract_code &lt;dbl&gt; 250750705000001, 250750705000002, 250750705000003, 25075…</span></span>
<span><span class="co">#&gt; $ population &lt;dbl&gt; 394, 774, 643, 317, 605, 607, 494, 1062, 337, 677, 637, …</span></span>
<span><span class="co">#&gt; $ geom       &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-34.8739674..., MULTIPOLYGO…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="import-data" class="level2"><h2 class="anchored" data-anchor-id="import-data">Import Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"2025-01.rds"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="filter-data" class="level2"><h2 class="anchored" data-anchor-id="filter-data">Filter Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">municipality_code</span> <span class="op">==</span> <span class="va">.env</span><span class="op">$</span><span class="va">municipality</span>,</span>
<span>    <span class="va">geocodebr_precision</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"numero"</span>, <span class="st">"numero_aproximado"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">cnpj</span>,</span>
<span>    <span class="va">longitude</span>,</span>
<span>    <span class="va">latitude</span>,</span>
<span>    <span class="va">locais_nova_g0</span>,</span>
<span>    <span class="va">locais_nova_g1_g2</span>,</span>
<span>    <span class="va">locais_nova_g3</span>,</span>
<span>    <span class="va">locais_nova_g4</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="transform-data" class="level2"><h2 class="anchored" data-anchor-id="transform-data">Transform Data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"locais_nova_"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span></span>
<span>      <span class="va">group</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="st">"locais_nova_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">shape</span>, join <span class="op">=</span> <span class="va">st_within</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cnpj</span>, <span class="va">group</span>, <span class="va">geometry</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="exploratory-analysis" class="level2"><h2 class="anchored" data-anchor-id="exploratory-analysis">Exploratory Analysis</h2>
<section id="glimpse-data" class="level3"><h3 class="anchored" data-anchor-id="glimpse-data">Glimpse Data</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 10,457</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ cnpj     &lt;chr&gt; "45.543.915/0103-06", "45.543.915/0103-06", "06.057.223/05…</span></span>
<span><span class="co">#&gt; $ group    &lt;chr&gt; "G0", "G1-G2", "G0", "G1-G2", "G0", "G1-G2", "G0", "G1-G2"…</span></span>
<span><span class="co">#&gt; $ geometry &lt;POINT [°]&gt; POINT (-34.87904145 -7.1205..., POINT (-34.87904145 …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="plot-establishments" class="level3"><h3 class="anchored" data-anchor-id="plot-establishments">Plot Establishments</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the distribution of food establishments categorized by Locais-Nova scale groups <span class="citation" data-cites="silva2025">(<a href="#ref-silva2025" role="doc-biblioref">Silva et al., 2025</a>)</span>. Note that an establishment may belong to multiple groups.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">shape</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gray90"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.01</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://danielvartan.github.io/brandr/reference/scale_brand.html">scale_color_brand_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="plot-tract-population" class="level3"><h3 class="anchored" data-anchor-id="plot-tract-population">Plot Tract Population</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the population distribution across census tracts within the selected municipality.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">shape</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gray90"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">census_data</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">population</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Population"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section></section><section id="compute-maximal-coverage-location-allocation" class="level2"><h2 class="anchored" data-anchor-id="compute-maximal-coverage-location-allocation">Compute Maximal Coverage Location-Allocation</h2>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This process may require substantial computational resources, depending on the area’s size and the number of establishments analyzed. Ensure your system has adequate capacity before proceeding.</p>
</div>
</div>
</div>
<section id="filter-locais-nova-group" class="level3"><h3 class="anchored" data-anchor-id="filter-locais-nova-group">Filter Locais-Nova Group</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"G0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"WGS84"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="normalize-municipality-shape-crs" class="level3"><h3 class="anchored" data-anchor-id="normalize-municipality-shape-crs">Normalize Municipality Shape CRS</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation_shape</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">shape</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"WGS84"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="plot-food-establishments" class="level3"><h3 class="anchored" data-anchor-id="plot-food-establishments">Plot Food Establishments</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the spatial distribution of food establishments within the selected Locais-Nova scale group.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">shape</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gray90"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://danielvartan.github.io/brandr/reference/get_brand_color.html">get_brand_color</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.01</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"WGS84"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://danielvartan.github.io/brandr/reference/scale_brand.html">scale_color_brand_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="compute-travel-time" class="level3"><h3 class="anchored" data-anchor-id="compute-travel-time">Compute Travel Time</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">travel_time_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">allocation_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/traveltime.html">traveltime</a></span><span class="op">(</span></span>
<span>    bb_area <span class="op">=</span> <span class="va">allocation_shape</span>,</span>
<span>    dowscaling_model_type <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"walk"</span>,</span>
<span>    res_output <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="plot-travel-time" class="level3"><h3 class="anchored" data-anchor-id="plot-travel-time">Plot Travel Time</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates walking travel times from food establishments within the selected Locais-Nova scale group, considering the spatial friction of the area. Contour lines represent travel times up to the specified objective minutes.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">travel_time_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/traveltime_plot.html">traveltime_plot</a></span><span class="op">(</span></span>
<span>    bb_area <span class="op">=</span> <span class="va">allocation_shape</span>,</span>
<span>    facilities <span class="op">=</span> <span class="va">allocation_data</span>,</span>
<span>    contour_traveltime <span class="op">=</span> <span class="va">objective_minutes</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/Travel Time Plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/Travel Time Plot-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="rasterize-population-data" class="level3"><h3 class="anchored" data-anchor-id="rasterize-population-data">Rasterize Population Data</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_raster_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">census_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tract_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"WGS84"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html">st_rasterize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="st">"Raster"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="compute-travel-time-stats" class="level3"><h3 class="anchored" data-anchor-id="compute-travel-time-stats">Compute Travel Time Stats</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the cumulative population coverage achieved within the specified travel time intervals from food establishments in the selected Locais-Nova scale group, highlighting accessibility patterns and potential gaps in coverage.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">travel_time_stats</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">travel_time_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/traveltime_stats.html">traveltime_stats</a></span><span class="op">(</span></span>
<span>    demand <span class="op">=</span> <span class="va">census_raster_data</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>    objectiveminutes <span class="op">=</span> <span class="va">objective_minutes</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; ℹ 87.51% of coverage within the 15 minutes threshold.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/Travel Time Stats-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/Travel Time Stats-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="compute-location-allocation-continuous-approach" class="level3"><h3 class="anchored" data-anchor-id="compute-location-allocation-continuous-approach">Compute Location-Allocation (Continuous Approach)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">census_raster_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/allocation.html">allocation</a></span><span class="op">(</span></span>
<span>    bb_area <span class="op">=</span> <span class="va">shape</span>,</span>
<span>    facilities <span class="op">=</span> <span class="va">allocation_data</span>,</span>
<span>    traveltime <span class="op">=</span> <span class="va">travel_time_data</span>,</span>
<span>    weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    objectiveminutes <span class="op">=</span> <span class="va">objective_minutes</span>,</span>
<span>    objectiveshare <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>    heur <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>    approach <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>    exp_demand <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    exp_weights <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  12.1534437843047 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  11.2847696998063 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  11.0585620628387 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  9.94214807418508 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  7.94158021807322 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  7.91344091967339 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  7.91344091967339 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  6.47803566149058 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  6.47803566149058 %"</span></span>
<span><span class="co">#&gt; [1] "Fraction of unmet demand:  2.99186020092346 %"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="plot-location-allocation-continuous-approach" class="level3"><h3 class="anchored" data-anchor-id="plot-location-allocation-continuous-approach">Plot Location-Allocation (Continuous Approach)</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the amount and optimal locations for food establishments within the selected Locais-Nova scale group, considering the objective travel time and population coverage.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/allocation_plot.html">allocation_plot</a></span><span class="op">(</span>bb_area <span class="op">=</span> <span class="va">shape</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><a href="index_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="compute-location-allocation-discrete-approach" class="level3"><h3 class="anchored" data-anchor-id="compute-location-allocation-discrete-approach">Compute Location-Allocation (Discrete Approach)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">census_raster_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/allocation_discrete.html">allocation_discrete</a></span><span class="op">(</span></span>
<span>    bb_area <span class="op">=</span> <span class="va">shape</span>,</span>
<span>    candidate <span class="op">=</span> <span class="va">shape</span>, <span class="co"># |&gt; st_sample(20),</span></span>
<span>    facilities <span class="op">=</span> <span class="va">allocation_data</span>,</span>
<span>    n_fac <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    traveltime <span class="op">=</span> <span class="va">traveltime</span>,</span>
<span>    weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    objectiveminutes <span class="op">=</span> <span class="va">objective_minutes</span>,</span>
<span>    objectiveshare <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>    approach <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>    exp_demand <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    exp_weights <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    par <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="plot-location-allocation-discrete-approach" class="level3"><h3 class="anchored" data-anchor-id="plot-location-allocation-discrete-approach">Plot Location-Allocation (Discrete Approach)</h3>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This plot illustrates the amount and optimal locations for food establishments within the selected Locais-Nova scale group, considering the amount of facilities, objective travel time, and population coverage.</p>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">allocation</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://giacfalk.github.io/locationallocation/reference/allocation_plot_discrete.html">allocation_plot_discrete</a></span><span class="op">(</span>bb_area <span class="op">=</span> <span class="va">shape</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="citation" class="level2"><h2 class="anchored" data-anchor-id="citation">Citation</h2>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>When using this data, you must also cite the original data sources.</p>
</div>
</div>
</div>
<p>To cite this work, please use the following format:</p>
<p>Vartanian, D., Silva, L. G., Fernandes, C. N., &amp; Giannotti, M. A. (2025). <em>A reproducible pipeline for maximal coverage location-allocation of food establishments in Brazil using the Locais-Nova scale</em> [Computer software]. Center for Metropolitan Studies of the University of São Paulo. <a href="https://cem-usp.github.io/locais-nova-location-allocation" class="uri">https://cem-usp.github.io/locais-nova-location-allocation</a></p>
<p>A BibLaTeX entry for LaTeX users is:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>@software{silva2025,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  title = {A reproducible pipeline for maximal coverage location-allocation of food establishments in Brazil using the Locais-Nova scale},</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  author = {{Daniel Vartanian} and {Letícia Gonçalves Silva} and {Camila Nastari Fernandes} and {Mariana Abrantes Giannotti}},</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  year = {2025},</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  address = {São Paulo},</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  institution = {Center for Metropolitan Studies of the University of São Paulo},</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  langid = {en},</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  url = {https://cem-usp.github.io/locais-nova-location-allocation}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="license" class="level2"><h2 class="anchored" data-anchor-id="license">License</h2>
<div style="text-align: left;">
<p><a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/license-GPLv3-bd0000.svg" class="img-fluid" alt="License: GPLv3"></a> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/license-CC_BY--NC--SA_4.0-lightgrey.svg" class="img-fluid" alt="License: CC BY-NC-SA 4.0"></a></p>
</div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The original data sources may be subject to their own licensing terms and conditions.</p>
</div>
</div>
</div>
<p>The code in this repository is licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0">GNU General Public License Version 3</a>, while the report is available under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<pre><code>Copyright (C) 2025 Center for Metropolitan Studies

The code in this report is free software: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your option)
any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with
this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</code></pre>
</section><section id="acknowledgments" class="level2"><h2 class="anchored" data-anchor-id="acknowledgments">Acknowledgments</h2>
<div style="display: flex; align-items: flex-start; margin-bottom: 2em;">
<div style="flex: 0 0 30%; display: flex; justify-content: center; margin: auto 0;">
<a href="https://doi.org/10.17605/OSF.IO/ZE6WT">
<img src="images/acessosan-logo.svg" alt="AcessoSAN Logo" style="max-width: 140px; width: 100%; height: auto;"></a>
</div>
<div style="flex: 1; padding-left: 1em;">This work is part of a research project by the Polytechnic School (<a href="https://www.poli.usp.br/">Poli</a>) of the University of São Paulo (<a href="https://usp.br/">USP</a>), in partnership with the Secretariat for Food and Nutrition Security (<a href="https://www.gov.br/mds/pt-br/orgaos/SESAN">SESAN</a>) of the Ministry of Social Development, Family, and the Fight Against Hunger (<a href="https://www.gov.br/mds/">MDS</a>), titled: <em>AcessoSAN: Mapping Food Access to Support Public Policies on Food and Nutrition Security and Hunger Reduction in Brazilian Cities</em>.</div>
</div>
<div style="display: flex; align-items: flex-start; margin-bottom: 2em;">
<div style="flex: 0 0 30%; display: flex; justify-content: center; margin: auto 0;">
<a href="https://centrodametropole.fflch.usp.br">
<img src="images/cem-icon.svg" alt="CEM Logo" style="max-width: 190px; width: 100%; height: auto;"></a>
</div>
<div style="flex: 1; padding-left: 1em;">This work was developed with support from the Center for Metropolitan Studies (<a href="https://centrodametropole.fflch.usp.br">CEM</a>) based at the School of Philosophy, Letters and Human Sciences (<a href="https://www.fflch.usp.br/">FFLCH</a>) of the University of São Paulo (<a href="https://usp.br">USP</a>) and at the Brazilian Center for Analysis and Planning (<a href="https://cebrap.org.br/">CEBRAP</a>).</div>
</div>
<div style="display: flex; align-items: flex-start; margin-bottom: 2em;">
<div style="flex: 0 0 30%; display: flex; justify-content: center; margin: auto 0;">
<a href="https://fapesp.br/">
<img src="images/fapesp-logo.svg" alt="FAPESP Logo" style="max-width: 160px; width: 100%; height: auto;"></a>
</div>
<div style="flex: 1; padding-left: 1em;">This study was financed, in part, by the São Paulo Research Foundation (<a href="https://fapesp.br/">FAPESP</a>), Brazil. Process Number <a href="https://bv.fapesp.br/en/bolsas/231507/geospatial-data-science-applied-to-food-policies/">2025/17879-2</a>.</div>
</div>
</section><section id="references" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-allaire" class="csl-entry" role="listitem">
Allaire, J. J., Teague, C., Xie, Y., &amp; Dervieux, C. (n.d.). <em>Quarto</em> [Computer software]. Zenodo. <a href="https://doi.org/10.5281/ZENODO.5960048">https://doi.org/10.5281/ZENODO.5960048</a>
</div>
<div id="ref-brasil" class="csl-entry" role="listitem">
Brasil, Ministério da Saúde, &amp; Departamento de Informática do SUS. (n.d.). <em>Banco de dados do Sistema Único de Saúde - DATASUS</em>. Retrieved July 17, 2024, from <a href="https://datasus.saude.gov.br/">https://datasus.saude.gov.br/</a>
</div>
<div id="ref-brasila" class="csl-entry" role="listitem">
Brasil, &amp; Sistema de Vigilância Alimentar e Nutricional. (n.d.). <em>Módulo gerador de relatórios públicos: estado nutricional dos indivíduos acompanhados por período, fase do ciclo da vida e índice</em>. Retrieved September 23, 2024, from <a href="https://sisaps.saude.gov.br/sisvan/relatoriopublico">https://sisaps.saude.gov.br/sisvan/relatoriopublico</a>
</div>
<div id="ref-map2019a" class="csl-entry" role="listitem">
Malaria Atlas Project. (2019). <em>Friction surface: <span>Global</span> walking only friction surface</em> (Version 202001) [GeoTIFF]. <a href="https://data.malariaatlas.org/maps?layers=Accessibility:202001_Global_Walking_Only_Friction_Surface">https://data.malariaatlas.org/maps?layers=Accessibility:202001_Global_Walking_Only_Friction_Surface</a>
</div>
<div id="ref-openstreetmap" class="csl-entry" role="listitem">
OpenStreetMap Contributors. (n.d.). <em><span>OpenStreetMap</span></em> [Computer software]. OpenStreetMap Foundation. <a href="https://www.openstreetmap.org">https://www.openstreetmap.org</a>
</div>
<div id="ref-pereirab" class="csl-entry" role="listitem">
Pereira, R. H. M., &amp; Goncalves, C. N. (n.d.). <em><span class="nocase">geobr</span>: <span>Download</span> official spatial data sets of <span>Brazil</span></em> [Computer software]. <a href="https://doi.org/10.32614/CRAN.package.geobr">https://doi.org/10.32614/CRAN.package.geobr</a>
</div>
<div id="ref-pereiraa" class="csl-entry" role="listitem">
Pereira, R. H. M., &amp; Herszenhut, D. (n.d.). <em><span class="nocase">geocodebr</span>: <span>Geolocalização</span> de endereços brasileiros</em> [Computer software]. <a href="https://doi.org/10.32614/CRAN.package.geocodebr">https://doi.org/10.32614/CRAN.package.geocodebr</a>
</div>
<div id="ref-rcoreteama" class="csl-entry" role="listitem">
R Core Team. (n.d.). <em>R: <span>A</span> language and environment for statistical computing</em> [Computer software]. R Foundation for Statistical Computing. <a href="https://www.R-project.org">https://www.R-project.org</a>
</div>
<div id="ref-silva2025" class="csl-entry" role="listitem">
Silva, M. A. L. da, Mendes, L. L., Leite, M. A., Rocha, L. L., Borges, C. A., Levy, R. B., &amp; Louzada, M. L. da C. (2025). Sistema de classificação dos locais de aquisição de alimentos com base no <span><em>Guia Alimentar para a População Brasileira</em></span>: Locais-Nova. <em>Epidemiologia e Serviços de Saúde</em>, <em>34</em>, e20240361. <a href="https://doi.org/10.1590/S2237-96222025v34.20240361.pt">https://doi.org/10.1590/S2237-96222025v34.20240361.pt</a>
</div>
<div id="ref-usheya" class="csl-entry" role="listitem">
Ushey, K., &amp; Wickham, H. (n.d.). <em><span class="nocase">renv</span>: <span>Project</span> environments</em> [Computer software]. <a href="https://doi.org/10.32614/CRAN.package.renv">https://doi.org/10.32614/CRAN.package.renv</a>
</div>
<div id="ref-vartanian2025z" class="csl-entry" role="listitem">
Vartanian, D., Penz, C. de L. e. S., Caldeira, G., Fernandes, C. N., &amp; Giannotti, M. A. (2025). <em>A reproducible pipeline for processing, geocoding, and classifying <span>CNPJs</span> from the <span>Brazilian Federal Revenue Service</span> (<span>RFB</span>) using the <span>Locais-Nova</span> scale</em> [Computer software]. Center for Metropolitan Studies of the University of São Paulo. <a href="https://cem-usp.github.io/locais-nova-rfb-geocoding">https://cem-usp.github.io/locais-nova-rfb-geocoding</a>
</div>
<div id="ref-wickhamb" class="csl-entry" role="listitem">
Wickham, H. (n.d.-a). <em>The tidyverse style guide</em>. Retrieved July 17, 2023, from <a href="https://style.tidyverse.org">https://style.tidyverse.org</a>
</div>
<div id="ref-wickhamc" class="csl-entry" role="listitem">
Wickham, H. (n.d.-b). <em>Tidy design principles</em>. <a href="https://design.tidyverse.org">https://design.tidyverse.org</a>
</div>
<div id="ref-wickham2023c" class="csl-entry" role="listitem">
Wickham, H. (2023). <em>The tidy tools manifesto</em>. Tidyverse. <a href="https://tidyverse.tidyverse.org/articles/manifesto.html">https://tidyverse.tidyverse.org/articles/manifesto.html</a>
</div>
<div id="ref-wickham2023e" class="csl-entry" role="listitem">
Wickham, H., Çetinkaya-Rundel, M., &amp; Grolemund, G. (2023). <em>R for data science: <span>Import</span>, tidy, transform, visualize, and model data</em> (2nd ed.). O’Reilly Media. <a href="https://r4ds.hadley.nz">https://r4ds.hadley.nz</a>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cem-usp\.github\.io\/locais-nova-location-allocation\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/edit/main/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/blob/main/index.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/cem-usp/locais-nova-location-allocation/issues/" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>